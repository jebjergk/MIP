# MIP Table & View Catalog

| Object | Purpose | Grain (one row = …) | Key columns | How populated |
| --- | --- | --- | --- | --- |
| `MIP.APP.INGEST_UNIVERSE` | Universe of symbols/market types/intervals to ingest (STOCK/ETF/FX). | One symbol + market type + interval. | `SYMBOL`, `MARKET_TYPE`, `INTERVAL_MINUTES` | Seeded in `050_app_core_tables.sql`; used by pipeline to determine market types to process.【F:SQL/app/050_app_core_tables.sql†L10-L83】【F:SQL/app/145_sp_run_daily_pipeline.sql†L31-L80】 |
| `MIP.APP.PATTERN_DEFINITION` | Pattern configuration and activation metadata. | One pattern definition. | `PATTERN_ID`, `NAME`, `PARAMS_JSON`, `IS_ACTIVE` | Seeded in `050_app_core_tables.sql`; referenced by recommendation generator.【F:SQL/app/050_app_core_tables.sql†L85-L183】【F:SQL/app/070_sp_generate_momentum_recs.sql†L64-L186】 |
| `MIP.MART.MARKET_BARS` | Cleaned base table of market OHLCV bars. | One bar for a symbol/market type/interval/timestamp. | `MARKET_TYPE`, `SYMBOL`, `INTERVAL_MINUTES`, `TS` | Upserted by `SP_INGEST_ALPHAVANTAGE_BARS` (called by daily pipeline).【F:SQL/mart/010_mart_market_bars.sql†L12-L24】【F:SQL/app/030_sp_ingest_alphavantage_bars.sql†L407-L450】【F:SQL/app/145_sp_run_daily_pipeline.sql†L31-L118】 |
| `MIP.MART.MARKET_RETURNS` | Returns per bar (simple and log), derived from `MARKET_BARS`. | One bar with return metrics for each symbol/interval. | `RETURN_SIMPLE`, `RETURN_LOG`, `PREV_CLOSE` | `CREATE OR REPLACE VIEW` in daily pipeline (and also in mart build).【F:SQL/mart/010_mart_market_bars.sql†L48-L107】【F:SQL/app/145_sp_run_daily_pipeline.sql†L119-L218】 |
| `MIP.APP.RECOMMENDATION_LOG` | Log of recommendations emitted by patterns. | One recommendation event. | `RECOMMENDATION_ID`, `PATTERN_ID`, `SYMBOL`, `TS`, `SCORE` | Inserted by `SP_GENERATE_MOMENTUM_RECS` (called in pipeline).【F:SQL/app/050_app_core_tables.sql†L194-L212】【F:SQL/app/070_sp_generate_momentum_recs.sql†L1-L235】【F:SQL/app/145_sp_run_daily_pipeline.sql†L255-L371】 |
| `MIP.APP.RECOMMENDATION_OUTCOMES` | Evaluation results for recommendations across horizons. | One recommendation-horizon result. | `RECOMMENDATION_ID`, `HORIZON_BARS`, `REALIZED_RETURN`, `HIT_FLAG`, `EVAL_STATUS` | Upserted by `SP_EVALUATE_RECOMMENDATIONS` (called in pipeline).【F:SQL/app/050_app_core_tables.sql†L215-L239】【F:SQL/app/105_sp_evaluate_recommendations.sql†L33-L154】【F:SQL/app/145_sp_run_daily_pipeline.sql†L401-L444】 |
| `MIP.APP.PORTFOLIO` | Portfolio configuration and high-level results. | One portfolio. | `PORTFOLIO_ID`, `PROFILE_ID`, `STATUS`, `STARTING_CASH` | Seeded/maintained in `160_app_portfolio_tables.sql`; updated by portfolio simulation results.【F:SQL/app/160_app_portfolio_tables.sql†L45-L98】【F:SQL/app/180_sp_run_portfolio_simulation.sql†L1-L180】 |
| `MIP.APP.PORTFOLIO_POSITIONS` | Simulated holdings per portfolio run. | One position entry. | `PORTFOLIO_ID`, `RUN_ID`, `SYMBOL`, `ENTRY_TS` | Written by `SP_RUN_PORTFOLIO_SIMULATION`.【F:SQL/app/160_app_portfolio_tables.sql†L101-L129】【F:SQL/app/180_sp_run_portfolio_simulation.sql†L1-L180】 |
| `MIP.APP.PORTFOLIO_TRADES` | Simulated trades per portfolio run. | One trade event. | `TRADE_ID`, `PORTFOLIO_ID`, `RUN_ID`, `TRADE_TS` | Written by `SP_RUN_PORTFOLIO_SIMULATION`.【F:SQL/app/160_app_portfolio_tables.sql†L132-L158】【F:SQL/app/180_sp_run_portfolio_simulation.sql†L1-L180】 |
| `MIP.APP.PORTFOLIO_DAILY` | Daily equity time series for a portfolio run. | One portfolio-day. | `PORTFOLIO_ID`, `RUN_ID`, `TS`, `TOTAL_EQUITY` | Written by `SP_RUN_PORTFOLIO_SIMULATION`, read by KPI views.【F:SQL/app/160_app_portfolio_tables.sql†L161-L186】【F:SQL/views/mart/v_portfolio_run_kpis.sql†L1-L122】 |
| `MIP.MART.REC_OUTCOME_COVERAGE` | Coverage/maturity status of outcomes by pattern and horizon. | One row per pattern/market/interval/horizon. | `N_TOTAL`, `N_SUCCESS`, `COVERAGE_RATE`, `LATEST_MATURED_ENTRY_TS` | View over outcomes + log.【F:SQL/mart/030_mart_rec_outcome_views.sql†L1-L27】 |
| `MIP.MART.REC_OUTCOME_PERF` | Performance stats for matured outcomes. | One row per pattern/market/interval/horizon. | `AVG_RETURN`, `HIT_RATE`, `SCORE_RETURN_CORR` | View over outcomes + log, filtered to `EVAL_STATUS='SUCCESS'`.【F:SQL/mart/030_mart_rec_outcome_views.sql†L29-L55】 |
| `MIP.MART.REC_PATTERN_TRUST_RANKING` | Combined coverage/performance trust score. | One row per pattern/market/interval/horizon. | `TRUST_SCORE` | View derived from coverage + performance views.【F:SQL/mart/030_mart_rec_outcome_views.sql†L57-L82】 |
| `MIP.MART.REC_TRAINING_KPIS` | Training KPI view (hit rate, expectancy, loss streaks, time windows). | One row per pattern/market/interval/horizon. | `HIT_RATE`, `EXPECTANCY`, `MAX_LOSS_STREAK`, 30/90-day metrics | View over outcomes + log.【F:SQL/mart/020_mart_rec_training_kpis.sql†L1-L109】 |
| `MIP.APP.V_PATTERN_KPIS` | Pattern-level KPI aggregation (sample count, hit rate, return stats). | One row per pattern/market/interval/horizon. | `SAMPLE_COUNT`, `HIT_RATE`, `AVG_FORWARD_RETURN` | View over outcomes + log.【F:SQL/app/090_recommendation_outcome_kpis.sql†L1-L22】 |
| `MIP.MART.V_PORTFOLIO_RUN_KPIS` | Run-level KPI rollup for portfolio simulations. | One row per portfolio run. | `PORTFOLIO_ID`, `RUN_ID`, `TOTAL_RETURN`, `MAX_DRAWDOWN` | View over `PORTFOLIO_DAILY` + portfolio metadata.【F:SQL/views/mart/v_portfolio_run_kpis.sql†L1-L122】 |
| `MIP.MART.V_PORTFOLIO_RUN_EVENTS` | Run-level stop/event markers. | One row per portfolio run. | `DRAWDOWN_STOP_TS`, `STOP_REASON` | View over `PORTFOLIO_DAILY` + profile data.【F:SQL/views/mart/v_portfolio_run_events.sql†L1-L62】 |
| `MIP.MART.V_MORNING_BRIEF_JSON` | JSON composition of trusted signals, risk, and attribution for agents. | One JSON brief snapshot. | `BRIEF` | View composed from agent input views + delta view.【F:SQL/views/mart/v_morning_brief_json.sql†L1-L139】 |
| `MIP.AGENT_OUT.MORNING_BRIEF` | Persisted morning brief snapshots for agents. | One brief per portfolio/run. | `PORTFOLIO_ID`, `RUN_ID`, `BRIEF` | Merged by `SP_WRITE_MORNING_BRIEF` (pipeline step).【F:SQL/app/185_agent_out_morning_brief.sql†L1-L17】【F:SQL/app/186_sp_write_morning_brief.sql†L1-L48】 |
| `MIP.APP.MIP_AUDIT_LOG` | Append-only audit log for pipeline and procedures. | One event log entry. | `EVENT_TS`, `RUN_ID`, `EVENT_TYPE`, `STATUS`, `DETAILS` | Inserted by `SP_LOG_EVENT` and pipeline steps.【F:SQL/app/055_app_audit_log.sql†L7-L39】 |

## Explicit semantics for key tables
- **`RECOMMENDATION_LOG`**: each row is a recommendation emitted by a pattern at a specific bar timestamp; `SCORE` holds the pattern score/strength used for later KPI correlation.【F:SQL/app/050_app_core_tables.sql†L194-L212】
- **`RECOMMENDATION_OUTCOMES`**: each row is an evaluation result for a recommendation at a given horizon. `REALIZED_RETURN` and `HIT_FLAG` represent actual outcome performance, while `EVAL_STATUS` signals whether data was sufficient to evaluate the horizon.【F:SQL/app/050_app_core_tables.sql†L215-L239】【F:SQL/app/105_sp_evaluate_recommendations.sql†L92-L124】
- **`MORNING_BRIEF`**: each row is a persisted JSON snapshot of the daily brief composed from trusted signals, portfolio risk, and attribution summaries.【F:SQL/views/mart/v_morning_brief_json.sql†L1-L139】【F:SQL/app/185_agent_out_morning_brief.sql†L1-L17】

## Key view dependencies (data model highlights)
- `V_TRUSTED_SIGNAL_POLICY` derives trust labels from `V_SIGNAL_OUTCOME_KPIS`.【F:SQL/views/mart/v_trusted_signal_policy.sql†L1-L33】【F:SQL/views/mart/v_signal_outcome_kpis.sql†L1-L53】
- `V_AGENT_DAILY_SIGNAL_BRIEF` compares current trust policy with prior outcomes (`RECOMMENDATION_LOG` + `RECOMMENDATION_OUTCOMES`) to surface daily signal shifts.【F:SQL/views/mart/v_agent_daily_signal_brief.sql†L1-L147】
- `V_AGENT_DAILY_ATTRIBUTION_BRIEF` rolls up `V_PORTFOLIO_ATTRIBUTION` to market-type totals and top contributors/detractors.【F:SQL/views/mart/v_agent_daily_attribution_brief.sql†L1-L140】
- `V_MORNING_BRIEF_JSON` composes trusted signals, watchlist items, risk status, attribution summaries, and delta changes from the agent input views and `V_MORNING_BRIEF_WITH_DELTA`.【F:SQL/views/mart/v_morning_brief_json.sql†L1-L139】【F:SQL/views/mart/v_morning_brief_with_delta.sql†L1-L190】

## Known unknowns / TODO
- **Missing from repo:** None identified for the objects explicitly requested in this documentation pack.
